<p><strong>Improvements including Multiple Sequence Alignment Algorithms</strong></p>

<p><em><a href="Google Summer of Code" title="wikilink">Google Summer of Code</a> Project by
<a href="Mark Chapman" title="wikilink">Mark Chapman</a></em></p>

<p><em>Mentored by <a href="Andreas Prlic" title="wikilink">Andreas Prlic</a></em></p>

<p><em>Co-mentored by Scooter Willis and Kyle Ellrott</em></p>

<p>Biologists infer evolutionary, structural, and functional relationships
between biopolymers from similarities and divergences of primary
structure in multiple sequence alignments. This summer project will add
a module which manages an alignment and offers several implementation
options. Initial code will establish a framework for alignments that
outlines a standard four stage approach of pairwise similarity
calculation, hierarchical clustering, progressive alignment, and
refinement. Each step will get filled in with details from the most
pervasive progressive alignment algorithm, clustalw. Further work will
then add alternative methods which update the stages to increase speed,
improve accuracy, or change the scope of the multiple sequence
alignment.</p>

<h2 id="milestones">Milestones</h2>

<p><img src="Flowchart-ProgressiveMultipleSequenceAlignment.png" alt="Diagram of Progressive Multiple Sequence Alignment in which boxes
represent data and diamonds show
algorithms" title="Diagram of Progressive Multiple Sequence Alignment in which boxes represent data and diamonds show algorithms" /></p>

<p>The first milestone consists of mostly design work, setting up package
outlines, and writing interface hierarchies. The goal is to create an
interface that allows both simple use with preset options and advanced
customization. This will update the current alignment module to BioJava
3 and define the extension to multiple sequence alignments. The
independence of the program components is key here. For example,
pairwise alignments that rely on annotations of function or structure
could create a similarity matrix while the rest of the routine defaults
to run like clustalw. This flexible interface will allow the addition of
more modern algorithms since most still follow the same four stage
approach and even rely on many of the classic algorithms at some point
during the alignment.</p>

<p>The second phase of this project implements a default alignment routine
based on clustalw. Output from updated pairwise alignments will connect
to the existing hierarchical clustering algorithms in the phylogeny
module. Then, the resulting tree will guide a progressive alignment
which outputs a multiple sequence alignment. This requires a data
structure to hold profiles of multiple sequences and an algorithm for
profile-profile alignment. Even the original release of clustalw uses
several improvements to the naive algorithm which increase speed and
accuracy.</p>

<p>For the remainder of the summer, enhancements will be added to each
alignment stage. Many improvements upon clustalw have been published
including clustalw2, muscle, kalign, dialign, mafft, fsa, probcons, and
t-coffee, and psalign. Likely algorithms to integrate this summer are
pairwise similarities from Needleman-Wunsch (clustalw), K-mers
(clustalw/muscle), Wu-Manber (kalign), and structure (psc++/ce/fatcat),
guide trees from Neighbor Joining and UPGMA, profile-profile alignment
using a profile matrix (clustalw) or additive profile vectors (muscle)
with anchored restriction (Myers-Miller/muscle/dialign), and refinement
by both iterating (clustalw/muscle) and partitioning (muscle/kalign).</p>

<h2 id="timeline">Timeline</h2>

<p><img src="Timeline-GSoC_MSA.png" alt="Project Timeline for Google Summer of Code: Multiple Sequence
Alignment" title="Project Timeline for Google Summer of Code: Multiple Sequence Alignment" /></p>

<h3 id="design-flexible-interface">Design flexible interface</h3>

<p><em>May 24 - June 4</em></p>

<ul>
  <li>setup biojava3-alignment module
    <ul>
      <li>package outline, interface hierarchies</li>
      <li>framework: standard four stage approach
        <ol>
          <li>pairwise similarity calculation</li>
          <li>hierarchical clustering</li>
          <li>progressive alignment</li>
          <li>refinement</li>
        </ol>
      </li>
      <li>submit for comments from development list</li>
      <li>code interface/class hierarchy
        <ul>
          <li>mostly abstractions, stub methods with TODO comments, and
test cases
            <ul>
              <li>example use case: pairwise structure alignments create
similarity matrix while rest of the routine defaults to
run like clustalw</li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>update the current alignment module to biojava3
    <ul>
      <li>allow Compound list or string representation using BioJava 3
sequence package</li>
      <li>each alignment routine can choose either representation</li>
      <li>refine other aspects
        <ul>
          <li>implement Iterable<t> wherever an iterator<t> method exists
</t></t>            <ul>
              <li>allows use of for-each loop through collection</li>
            </ul>
          </li>
          <li>rework to better mesh with multiple sequence alignments</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="basic-clustalw">Basic clustalw</h3>

<p><em>June 7 - 18</em></p>

<ul>
  <li>calculate pairwise similarity matrix
    <ul>
      <li>get scores from pairwise Needleman-Wunsch algorithm
        <ul>
          <li>relatively slow, but already implemented in alignment module</li>
        </ul>
      </li>
      <li>make multi-threaded version (default)
        <ul>
          <li>all N*(N-1)/2 pairwise alignments are independent</li>
          <li>use ThreadPool utility, java.util.concurrent, Callable,
Future…</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>cluster into guide tree
    <ul>
      <li>convert scores to normalized distances</li>
      <li>allow choice of Neighbor Joining or UPGMA clustering
        <ul>
          <li>use implementations in phylo module</li>
          <li>NJ tree may need to be rooted</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>basic progressive alignment
    <ul>
      <li>naive profile-profile Needleman-Wunsch algorithm</li>
      <li>postfix tree traversal builds rough multiple sequence alignment
        <ul>
          <li>make multi-threaded, list alignment calls from leaves to
root</li>
        </ul>
      </li>
      <li>produce profile scores by sum of pairs</li>
    </ul>
  </li>
</ul>

<h3 id="full-clustalw">Full clustalw</h3>

<p><em>June 21 - July 2</em></p>

<ul>
  <li>anchored restriction (divide and conquer)
    <ul>
      <li>code Myers-Miller algorithm first</li>
      <li>generalize interface to later expand anchor sources (if time
permits)</li>
    </ul>
  </li>
  <li>other progressive alignment improvements
    <ul>
      <li>use sequence weighting to combine similar and divergent
sequences
        <ul>
          <li>adjusts for duplicate information that inflates sum of pairs
scores</li>
        </ul>
      </li>
      <li>choose substitution weight matrices
        <ul>
          <li>strict for similar profiles and lenient for distant profiles</li>
          <li>PAM and BLOSUM series for amino acid substitution</li>
        </ul>
      </li>
      <li>vary gap penalties for multiple reasons
        <ul>
          <li>weight matrix: adjust opening penalty</li>
          <li>profile similarity: adjust opening penalty</li>
          <li>profile lengths: adjust opening penalty</li>
          <li>profile length differences: adjust extension penalty</li>
          <li>existing gaps: adjust opening and extension penalities</li>
          <li>specific residues: adjust opening penalty</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>overall review
    <ul>
      <li>check through design (especially public interface) for any
improvements</li>
    </ul>
  </li>
  <li>post examples on wiki pages
    <ul>
      <li>show simple runs with default settings</li>
      <li>explain customization options and future modifications</li>
    </ul>
  </li>
</ul>

<h3 id="refinement">Refinement</h3>

<p><em>July 6 - July 16</em></p>

<ul>
  <li>iterative refinement
    <ul>
      <li>similarities from fractional identity of sequence pairs in rough
MSA</li>
      <li>recluster, realign, repeat</li>
    </ul>
  </li>
  <li>partition refinement
    <ul>
      <li>split set of aligned sequences, realign
        <ul>
          <li>single sequence removal, stochastic, and tree traversal</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h3 id="alternative-methods-for-each-msa-stage">Alternative methods for each MSA stage</h3>

<p><em>July 19 - 30</em></p>

<ul>
  <li>similarity matrix scoring
    <ul>
      <li>structure: psc++/ce/fatcat from structure module</li>
      <li>fast string matches: K-mers (clustalw/muscle), Wu-Manber
(kalign)
        <ul>
          <li>UkkonenSuffixTree utility should help</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>speed up profile-profile alignment
    <ul>
      <li>additive profile vectors (muscle)</li>
      <li>more sources for anchored restriction (muscle/dialign)</li>
    </ul>
  </li>
</ul>

<h3 id="time-permitting-ideas">Time permitting ideas</h3>

<p><em>August 2 - 20</em></p>

<ul>
  <li>polishing
    <ul>
      <li>code: public interface, readability, extensibility</li>
      <li>JUnit tests: missing coverage, future possibilities</li>
      <li>documentation: JavaDoc comments and examples on wiki</li>
    </ul>
  </li>
  <li>run benchmarks for protein (BAliBASE, PreFab) and RNA (BRAliBASE)</li>
  <li>update more code to BioJava3</li>
  <li>add scoring options
    <ul>
      <li>CORE from T-Coffee</li>
      <li>accuracy/sensitivity/specificity/consistency/certainty from FSA</li>
    </ul>
  </li>
  <li>check O(N^2) optimizations of NJ and UPGMA</li>
  <li>access clustr database for guide tree formation</li>
  <li>front end on PDB web site</li>
  <li>research and write roadmap for future directions</li>
</ul>

<h3 id="submit-code-samples-to-google">Submit code samples to Google</h3>

<p><em>August 30</em></p>

<h2 id="progress-log">Progress Log</h2>

<h3 id="may-24---may-28">May 24 - May 28</h3>

<ul>
  <li>setup biojava3-alignment module</li>
  <li>read Effective Java by Joshua Bloch</li>
  <li><a href="GSoC:MSA_Design" title="wikilink">design</a> work (incomplete)
    <ul>
      <li>update to current alignment module</li>
      <li>extension to multiple sequence alignment</li>
      <li>ConcurrencyTools utility for submitting parallel tasks to a
shared thread pool</li>
    </ul>
  </li>
</ul>

<h3 id="june-1---june-4">June 1 - June 4</h3>

<ul>
  <li><a href="GSoC:MSA_Design" title="wikilink">design</a> work
    <ul>
      <li>posted to wiki</li>
      <li>integrated ideas from mentors</li>
      <li>started coding</li>
    </ul>
  </li>
</ul>

<h3 id="june-7---june-11">June 7 - June 11</h3>

<ul>
  <li>implemented interface hierarchy
    <ul>
      <li>added documentation comments</li>
    </ul>
  </li>
  <li>outlined simple factory class <em>Alignments</em></li>
  <li>implemented data structures
    <ul>
      <li>gap penalty</li>
      <li>substitution matrix</li>
      <li>associated tests</li>
    </ul>
  </li>
</ul>

<h3 id="june-14---june-18">June 14 - June 18</h3>

<ul>
  <li>implemented global pairwise sequence alignment
    <ul>
      <li>aligned sequence</li>
      <li>profile</li>
      <li>sequence pair</li>
      <li>Needleman-Wunsch</li>
    </ul>
  </li>
  <li>implemented parallelization
    <ul>
      <li>concurrency tools: shared thread pool</li>
      <li>callable aligners and scorers</li>
      <li>factory methods which queue and run concurrent alignments and
scorings</li>
    </ul>
  </li>
</ul>

<h3 id="june-21---june-25">June 21 - June 25</h3>

<ul>
  <li>additional pairwise scoring options
    <ul>
      <li>fractional identity</li>
      <li>fractional similarity</li>
    </ul>
  </li>
  <li>guide tree formation
    <ul>
      <li>convert scores into distance matrix</li>
      <li>call neighbor joining in forester library</li>
    </ul>
  </li>
  <li>local pairwise sequence alignment
    <ul>
      <li>factory method</li>
      <li>profile</li>
      <li>sequence pair</li>
      <li>Smith-Waterman</li>
    </ul>
  </li>
  <li>profile-profile alignment
    <ul>
      <li>aligned sequence</li>
      <li>profile</li>
      <li>profile pair</li>
      <li>abstract aligner</li>
    </ul>
  </li>
</ul>

<h3 id="june-28---july-2">June 28 - July 2</h3>

<ul>
  <li>local pairwise sequence alignment
    <ul>
      <li>added tests</li>
      <li>fixed bug in data structure</li>
    </ul>
  </li>
  <li>similar/equivalent compounds
    <ul>
      <li>implemented in amino acid compound set</li>
      <li>sparked discussion about compound sets</li>
      <li>provided example to user on mailing list</li>
    </ul>
  </li>
  <li>alternative scorers
    <ul>
      <li>added tests for identical compounds</li>
      <li>added tests for similar compounds</li>
    </ul>
  </li>
  <li>profile-profile alignment
    <ul>
      <li>refactored matrix aligners</li>
      <li>researched profile score functions</li>
      <li>started GuideTree wrapper class</li>
    </ul>
  </li>
</ul>

<h3 id="july-5---july-9">July 5 - July 9</h3>

<ul>
  <li>profiles
    <ul>
      <li>added column counts and weights</li>
      <li>added single sequence profiles</li>
    </ul>
  </li>
  <li>profile-profile alignment
    <ul>
      <li>refactored matrix aligners (minor)</li>
      <li>finished GuideTree wrapper class
        <ul>
          <li>iterable from leaves to root</li>
        </ul>
      </li>
      <li>finished naive implementation</li>
      <li>added caching of profile vectors</li>
      <li>added concurrent progressive MSA</li>
    </ul>
  </li>
  <li>progressive MSA factory method
    <ul>
      <li>allows easy multiple sequence alignments</li>
    </ul>
  </li>
</ul>

<h3 id="july-12---july-16">July 12 - July 16</h3>

<ul>
  <li>rescore refinement
    <ul>
      <li>FractionalIdentityInProfileScorer</li>
      <li>FractionalSimilarityInProfileScorer</li>
      <li>Profile from 2 AlignedSequence</li>
    </ul>
  </li>
  <li>MSA options
    <ul>
      <li>researched algorithms and scoring methods used in several common
aligners</li>
      <li>listed stage options and ‘emulation’ defaults</li>
    </ul>
  </li>
  <li>arranged Alignments static class in 3 access levels</li>
  <li>wrote simple example programs</li>
  <li>benchmarked time for MSA stages</li>
</ul>

<h3 id="july-19---july-23">July 19 - July 23</h3>

<ul>
  <li>posted simple example programs to biojava3 cookbook
    <ul>
      <li><a href="BioJava:CookBook3:PSA" title="wikilink">Pairwise Sequence Alignment</a></li>
      <li><a href="BioJava:CookBook3:MSA" title="wikilink">Multiple Sequence Alignment</a></li>
    </ul>
  </li>
  <li>longer skype call than usual to prioritize additions yet this summer
    <ul>
      <li>variable gap penalty</li>
      <li>linear space alignment
        <ul>
          <li>read papers by Myers and Miller, Thompson, Guan and
Uberbacher, and Morgenstern et al</li>
        </ul>
      </li>
      <li>refinement</li>
      <li>benchmarking: time, memory, and quality
        <ul>
          <li>downloaded the snoal and susd pfam families and the dengue
and hiv genomes</li>
          <li>benchmarked time and memory (with 1.5GB limit)</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>various improvements
    <ul>
      <li>changed biojava3-genome dependency from jaligner to
biojava3-alignment</li>
      <li>refactored AlignedSequence to have Sequence generic type</li>
      <li>fixed various compiler warnings in core module</li>
      <li>added distance and similarity methods to Scorer interface</li>
      <li>added new thread pool options as discussed in call</li>
      <li>disabled test in structure module to allow a successful build</li>
      <li>changed private methods in Alignments to default access</li>
    </ul>
  </li>
</ul>

<h3 id="july-26---july-30">July 26 - July 30</h3>

<ul>
  <li>updated cookbook programs
    <ul>
      <li>added them to test folder in repository</li>
      <li>added <a href="BioJava:CookBook3:MSAProfiler" title="wikilink">time and memory usage
profiler</a></li>
    </ul>
  </li>
  <li>made improvements to memory usage during multiple sequence alignment
    <ul>
      <li>null out cached values after use (e.g. keep pairwise scores, but
not alignments)</li>
    </ul>
  </li>
  <li>various improvements
    <ul>
      <li>added hasGap method to Profile; implemented in SimpleProfile</li>
      <li>removed MSAEmulation; added comments about similar routines at
each stage</li>
      <li>worked around unchecked class cast warning; assert that compound
sets match in sequences and substitution matrix</li>
      <li>provided simple access to common substitution matrices:
SubstitutionMatrixHelper</li>
      <li>refactored aligner, scorer, and refiner enum types</li>
    </ul>
  </li>
</ul>

<h3 id="august-2---august-6">August 2 - August 6</h3>

<ul>
  <li>survived strep throat</li>
  <li>decided to pursue
<a href="http://www.osti.gov/bridge/purl.cover.jsp?purl=/10168027-kXI3LM/native/">Guan-Uberbacher</a>’s
linear space alignment
    <ul>
      <li>simpler concept than Myers-Miller; only forward scoring passes</li>
      <li>allows multiple divisions in each pass; improves time
requirement</li>
      <li>provides a hook for anchored alignments</li>
    </ul>
  </li>
</ul>

<h3 id="august-9---august-13">August 9 - August 13</h3>

<ul>
  <li>refactored alignment routines
    <ul>
      <li>granted access to all 3 score matrices built for affine gap
penalties</li>
      <li>reduced memory requirement of single pass routines: score
vectors and traceback matrix</li>
      <li>prepared for linear space alignment: traceback vectors (less
memory), but multiple passes (more time)</li>
    </ul>
  </li>
  <li>added alignment output formatting
    <ul>
      <li>allows interlacing of sequences to show aligned columns</li>
      <li>combines a header, alignment information (indices, etc.), and
sequence information (accession IDs, indices, etc.)</li>
      <li>outputs to CLUSTALW’s ALN, FASTA, and GCG’s MSF standard formats</li>
    </ul>
  </li>
</ul>

<h2 id="skype-call-notes">Skype call notes</h2>

<p><a href="MSA_skype_20100608" title="wikilink">June 8th</a>, <a href="MSA_skype_20100615" title="wikilink">June
15th</a>, <a href="MSA_skype_20100622" title="wikilink">June
22nd</a>, <a href="MSA_skype_20100629" title="wikilink">June
29th</a>, <a href="MSA_skype_20100721" title="wikilink">July
21st</a>, <a href="MSA_skype_20100727" title="wikilink">July
27th</a>, <a href="MSA_skype_20100810" title="wikilink">Aug
10th</a>, <a href="MSA_skype_20100817" title="wikilink">Aug
17th</a></p>

<h2 id="references">References</h2>

<ul>
  <li>BioJava — &lt;doi:10.1093/bioinformatics/btn397&gt;</li>
  <li>Review — &lt;doi:10.1093/bioinformatics/btp452&gt;</li>
  <li>Clustalw2 — &lt;doi:10.1093/bioinformatics/btm404&gt;</li>
  <li>Clustalw — PMID: 7984417</li>
  <li>Clustal — PMID: 3243435</li>
  <li>Muscle — &lt;doi:10.1186/1471-2105-5-113&gt;</li>
  <li>Kalign — &lt;doi:10.1186/1471-2105-6-298&gt;</li>
  <li>Anchors — &lt;doi:10.1186/1748-7188-1-6&gt;</li>
  <li>Dialign — &lt;doi:10.1186/1748-7188-3-6&gt;</li>
  <li>T-Coffee — &lt;doi:10.1006/jmbi.2000.4042&gt;</li>
  <li>FSA — &lt;doi:10.1371/journal.pcbi.1000392&gt;</li>
  <li>ProbCons — &lt;doi:10.1101/gr.2821705&gt;</li>
  <li>BAliBASE — &lt;doi:10.1002/prot.20527&gt;</li>
  <li>Adaptive — &lt;doi:10.1093/bioinformatics/bti828&gt;</li>
  <li>Parallel — &lt;doi:10.1186/1471-2105-5-128&gt;</li>
</ul>

<h2 id="comments">Comments</h2>

<p><em>Please add comments here…</em></p>
